---
layout: post
title:  "JPA使用联合主键"
date:  2017-01-03 10:34:16
categories:  后端  
tags:  Spring-Data-Jpa Oracle Spring
excerpt: Spring-Data-Jpa使用Oracle联合主键
---

* content
{:toc}

## 简要

*   介绍一下今天在开发时遇到的数据存储问题。
*   具体情况是建立一张表存储学生的成绩，但要求每个学生一年只能有一条成绩（即一条数据），这个时候仅仅用id这一列来标识的话很难做到数据不重复的问题，这就用到了Oracle的联合主键，让年份（nf）和学号（xh）组合成联合主键。

    数据格式如下

    ```
        nf      xh              score
        2017    20131812227     98
        2017    20131812228     99
        2016    20131812227     99
        2016    20131812228     99
        都是正确的，而
        2017    20131812227     99
        这条数据的联合主键已经存在所以存不进去，从而实现学生每年的成绩存储不重复的问题
        
    ```

## JPA实体类

####    讲一下 Spring-Date-JPA 如何映射实体类：

1. 先建一个联合主键的Java类，用来存你的联合主键。要求如下：
        
        1.必须要实现serializable接口
        2.需要有无参的构造函数
        3.@Embeddable注释,表示此类可以被插入某个entity中


```java

@Embeddable
public class CJBKey implements Serializable {
    private int nf;
    private String xh;
}

```

2.  新建用于持久化的实体类（CJB）。要求如下：
        
        1.必须要实现serializable接口
        2.需要有无参的构造函数
        3.不使用@Id了而是使用@EmbeddedId，加了这个注解就说明这里的主键是联合主键

```java

@Entity
@Table(name = "CJB")
public class CJB implements Serializable {

    private static final long serialVersionUID = 1L;

    @EmbeddedId
    private CJBKey key;
    private String score;
}

```
    
3.  数据库中对应的表结构

    ![Object](http://jiaohongwei.github.io/images/2017-01/20170110162025.png)
    


##  资料文档

*   Spring-Data-JPA api文档：http://docs.spring.io/spring-data/jpa/docs/2.0.0.M1/reference/html/
*   因为JPA底层还是Hibernate实现的，另附一份Hibernate文档： http://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#identifiers-generators@